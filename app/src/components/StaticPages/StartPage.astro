---
import { Template } from '@Frontend';
import Icon from '@Assets/Icons.astro';
import { ASSETS } from '@Assets/assets.registry';
import { getPageContent } from '@Content/siteContent';
import { getRandomAlbumTeaser } from '@utils/albumTeaser';
import '@Styles/sections/hero.css';

export const prerender = true;

const content = await getPageContent('home');

const meta = {
  title: content.title,
  description: content.description,
};

const hero = {
  ...content.hero,
  logo: ASSETS.mascot,
  image: ASSETS.mascot.src,
};

const intro = content.intro;
const feature = content.feature;
const links = content.contactLinks ?? [];
const contact = content.contact;

const albumData = getRandomAlbumTeaser() ?? null;

const isExternalLink = (href: string) => href.startsWith('http');
---
<Template.Base meta={meta}>
  <head>
    <link rel="preload" href={hero.logo.src} as="image" type="image/webp" />
  </head>

  <section class="content-section">
    <!--- Hero Card --->   
    <Template.Card class="card--plain card--flush card--center">
      <Fragment slot="body">

        <div class="hero">
          <div class="hero__backdrop" aria-hidden="true"></div>
          <div class="hero__content">
            <div class="hero__grid">
              <span class="hero__welcome is-signature">{hero.heading}</span>

              <div class="hero__signature-line is-signature">
                <span class="hero__to">to</span>
                <span class="hero__name">{hero.subheading}</span>
              </div>

              <div class="hero__main">
                <div class="hero__title is-fancy">
                  <span class="hero__title-word cozy">Cozy</span>&nbsp;<span class="hero__title-word cosmos">Cosmos</span>
                </div>
                <div class="hero__tagline is-italic is-fancy">{hero.subtitle}</div>
              </div>
            </div>
          </div>
        </div>
      
      </Fragment>
    </Template.Card>
  </section>
  <section class="content-section content-section--masonry">
      <!--- Intro Card --->  
      <Template.Card>
        <Fragment slot="head">
          <h2 class="card__title">{intro.heading}</h2>
        </Fragment>
        <Fragment slot="body">
          <div class="prose">
            {intro.paragraphs.map((paragraph) => (
              <p>{paragraph}</p>
            ))}
          </div>
        </Fragment>
        <Fragment slot="foot">
          <div class="prose">
            <p class="is-italic is-fancy">{intro.greeting}</p>
            <h4 class="is-italic is-signature">{intro.signature}</h4>
          </div>
        </Fragment>
      </Template.Card>

      <!--- Contact Card --->      
      <Template.Card class="" headClass="card__head--column">
        <Fragment slot="head">
          <h2 class="card__title">{contact.heading}</h2>
          <p>{contact.description}</p>
        </Fragment>
        <Fragment slot="body">
          <div class="controls controls--start controls--roomy">
            {links.map((link) => (
              <a
                class="control control--button control--large control--circle"
                href={link.href}
                rel={isExternalLink(link.href) ? 'noopener noreferrer' : undefined}
                target={isExternalLink(link.href) ? '_blank' : undefined}
              >
                <Icon class="media-icon media-icon--glow" kind={link.kind} />
              </a>
            ))}
          </div>
        </Fragment>
      </Template.Card>

      <!--- Featured Card ---> 
      <Template.Card  headClass="card__head--column">
        <Fragment slot="head">
          <h2 class="card__title">{feature.heading}</h2>
          <p>{feature.description}</p>
        </Fragment>  


        <Fragment slot="foot">       
          <Template.MediaFrame album={albumData} imageClass="media-image--cover" hasTitleOverlay={true}/>
        </Fragment>
      </Template.Card>
  </section>

  <script>
    import { initMediaFrame, initMediaLightbox, initMediaThumbs } from '@Scripts/mediaHandler.js';
    import { runOnReady } from '@Scripts/utils/_runOnReady.js';

    runOnReady(() => {
      const lightbox = initMediaLightbox();
      const api = initMediaFrame({ lightbox });

      if (api && lightbox?.el) {
        api.setLightbox(lightbox);
        api.addControls(lightbox.el);
        initMediaThumbs(api, lightbox.el);
      }
    });
  </script>
</Template.Base>
