---
import { Template } from '@Frontend';
import { PLACEHOLDER_COVER } from '@Assets/covers';
import { getEntriesBySectionAndCategory } from '@utils/getEntries';
import { createBlogEntryView, matchesEntrySlug } from '@utils/entryTransforms';
import type { CollectionEntry } from 'astro:content';

const placeholderCover = PLACEHOLDER_COVER.src;

// üëâ Hier stellst du ein, welchen Blog-Entry du testen willst:
const sectionSlug = 'tails';
const categorySlug = 'lucys-journeys';
const slug = 'tails-lucys-journeys-starlit-liftoff';

let errorMessage: string | undefined;

const entries = await getEntriesBySectionAndCategory(sectionSlug, categorySlug);
const entry = entries.find((candidate) => matchesEntrySlug(candidate, slug));

let blogView: ReturnType<typeof createBlogEntryView>['blog'] | undefined;
let BlogContent: Awaited<
  ReturnType<CollectionEntry<'blog'>['render']>
>['Content'] | undefined;

if (!entry) {
  errorMessage = 'We could not find that entry yet. Please check back soon!';
} else {
  // Parent-URL einfach selber bauen, wir brauchen sie nur f√ºr Back-Link / Header
  const parentHref = `/${sectionSlug}/${categorySlug}/`;

  const rendered = await entry.render();
  BlogContent = rendered.Content;

  const blogData = createBlogEntryView(entry, parentHref, {
    categorySlug,
    categoryDescription: undefined,
    parentPage: undefined,
    placeholderCover,
  });

  blogView = blogData.blog;
}
---

<Template.Base title="Entry layout test">
  {errorMessage ? (
    <section class="content-section">
      <Template.Card class="card--center">
        <Fragment slot="body">
          <p>{errorMessage}</p>
        </Fragment>
      </Template.Card>
    </section>
  ) : blogView && BlogContent ? (
    <>
      {/* Variante A: aktuelles Live-Layout 1:1 */}
      <section class="content-section">
        <Template.Card class="card--center card--plain">
          <Fragment slot="head">
            <h2 class="card__title">Variante A ‚Äì Current EntryBlog</h2>
          </Fragment>
        </Template.Card>
      </section>

      <Template.EntryBlog
        blog={{
          title: blogView.title,
          description: blogView.description,
          introParagraphs: blogView.introParagraphs,
          cover: blogView.cover,
          chapters: blogView.chapters,
          date: entry?.data?.date,
          category: entry?.data?.category,
        }}
        BlogContent={BlogContent}
      />

      {/* Hier drunter k√∂nnen wir sp√§ter Varianten B/C/D einh√§ngen */}
    </>
  ) : null}
</Template.Base>
