---
import { Template } from '@Frontend';
import Icons from '@Assets/Icons.astro';
import { ASSETS, COVERS, ICON_REGISTRY } from '@Assets/assets.registry';
import { Picture } from 'astro:assets';
import { isProd } from '@utils/env';
export const prerender = !isProd;

if (isProd) {
  return Astro.redirect('/');
}

const formatClassList = (value: string, fallback = 'default') =>
  value && value.trim().length > 0
    ? value
        .trim()
        .split(/\s+/)
        .map((cls) => `.${cls}`)
        .join(' ')
    : fallback;

const navSections = [
  { id: 'foundation', label: 'Foundation' },
  { id: 'shadows', label: 'Shadows & Glows' },
  { id: 'cards', label: 'Cards' },
  { id: 'controls', label: 'Controls' },
  { id: 'layouts', label: 'Control Layouts' },
  { id: 'media', label: 'Media & Icons' },
  { id: 'typography', label: 'Typography' },
];

const tokenGroups = [
  {
    title: 'Spacing & radius',
    description: 'Shared rhythm and rounding scale applied to every surface.',
    items: [
      {
        label: 'Spacing scale',
        tokens: ['--space-xxs', '--space-xs', '--space-s', '--space-m', '--space-l', '--space-xl', '--space-xxl', '--space-xxxl'],
      },
      {
        label: 'Corner radius',
        tokens: ['--radius-xxs', '--radius-xs', '--radius-s', '--radius-m', '--radius-l', '--radius-xl', '--radius-xxl'],
      },
    ],
  },
  {
    title: 'Color families',
    description: 'Dark, light and accent ramps that inform surface, text and media tints.',
    items: [
      {
        label: 'Dark spectrum',
        swatch: '--color-dark',
        tokens: ['--color-dark', '--color-dark--strong', '--color-dark--soft', '--color-dark--ghosty'],
      },
      {
        label: 'Light spectrum',
        swatch: '--color-light',
        tokens: ['--color-light', '--color-light--strong', '--color-light--soft', '--color-light--ghosty'],
      },
      {
        label: 'Accent core',
        swatch: '--color-accent',
        tokens: ['--color-accent', '--color-accent--strong', '--color-accent--soft', '--color-accent--ghosty'],
      },
      {
        label: 'Accent light',
        swatch: '--color-accent-light',
        tokens: ['--color-accent-light', '--color-accent-light--strong', '--color-accent-light--soft', '--color-accent-light--ghosty'],
      },
      {
        label: 'Accent dark',
        swatch: '--color-accent-dark',
        tokens: ['--color-accent-dark', '--color-accent-dark--strong', '--color-accent-dark--soft', '--color-accent-dark--ghosty'],
      },
    ],
  },
  {
    title: 'FX & motion',
    description: 'Reusable glow, shadow and transition stacks that cards and controls consume.',
    items: [
      {
        label: 'Surface shadows',
        tokens: ['--fx-shadow--soft', '--fx-shadow', '--fx-shadow--strong', '--fx-shadow-inset--ghosty', '--fx-shadow-inset--soft'],
      },
      {
        label: 'Glows & filters',
        tokens: ['--text-glow', '--icon-shadow', '--fx-glow', '--fx-glow--strong', '--fx-bright', '--fx-saturate'],
      },
      {
        label: 'Motion & transforms',
        tokens: ['--transition-state', '--transition-state--slow', '--transition-fade-in', '--transition-fade-out', '--transform-raise', '--transform-grow'],
      },
    ],
  },
];

const surfaceEffects = [
  {
    id: 'surface-soft',
    label: 'Surface Soft Shadow',
    token: '--fx-shadow--soft',
    preview: 'shadow-preview--surface-soft',
    description: 'Subtle lift used on thumbnails and compact frames.',
  },
  {
    id: 'surface-default',
    label: 'Surface Default Shadow',
    token: '--fx-shadow',
    preview: 'shadow-preview--surface-default',
    description: 'Primary elevation for cards and media wrappers.',
  },
  {
    id: 'surface-strong',
    label: 'Surface Strong Shadow',
    token: '--fx-shadow--strong',
    preview: 'shadow-preview--surface-strong',
    description: 'High emphasis surfaces like header or footer.',
  },
];

const textEffects = [
  {
    label: 'Soft text glow',
    className: 'text-preview text-preview--soft',
    description: 'Default glow paired with prose body copy.',
  },
  {
    label: 'Strong text glow',
    className: 'text-preview text-preview--strong',
    description: 'Used for hero headings and call-to-action highlights.',
  },
  {
    label: 'Icon shadow',
    className: 'text-preview text-preview--icon',
    description: 'Drop shadow applied to all `.media-icon` glyphs.',
  },
];

const cardVariants = [
  {
    title: 'Default card',
    classes: '',
    note: 'Backdropped surface with balanced spacing and default shadow stack.',
  },
  {
    title: 'Plain card',
    classes: 'card--plain',
    note: 'Removes blur + shadow when nested into other layouts.',
  },
  {
    title: 'Condensed card',
    classes: 'card--condense',
    note: 'Tighter vertical rhythm for dense control groupings.',
  },
  {
    title: 'Animated card',
    classes: 'card--animate',
    note: 'Hover lift and glow driven by `--card-transition` stack.',
  },
  {
    title: 'Flush media card',
    classes: 'card--flush card--stretch',
    note: 'Edge-to-edge media wrapper with zero padding.',
    showMedia: true,
  },
  {
    title: 'Centered card',
    classes: 'card--center',
    note: 'Aligns headline, badges and prose to the center.',
  },
];

const buttonVariants = [
  {
    label: 'Primary button',
    classes: 'control control--button',
    description: 'Uses `--control-bg`, drop shadow and glow hover states.',
  },
  {
    label: 'Plain button',
    classes: 'control control--button control--plain',
    description: 'Text-first control with transparent surface and glow hover.',
  },
];

const buttonSizes = [
  {
    label: 'Small',
    classes: 'control control--button control--small',
  },
  {
    label: 'Default',
    classes: 'control control--button',
  },
  {
    label: 'Large',
    classes: 'control control--button control--large',
  },
  {
    label: 'Circle',
    classes: 'control control--button control--circle',
    icon: 'paw',
  },
];

const badgeVariants = [
  {
    label: 'Default badge',
    classes: 'control control--badge',
  },
  {
    label: 'Plain badge',
    classes: 'control control--badge control--plain',
  },
];

const layoutGroups = [
  {
    title: 'Alignment',
    variants: [
      { label: 'controls--start', classes: 'controls controls--start' },
      { label: 'controls--center', classes: 'controls controls--center' },
      { label: 'controls--end', classes: 'controls controls--end' },
      { label: 'controls--spread', classes: 'controls controls--spread' },
      { label: 'controls--around', classes: 'controls controls--around' },
      { label: 'controls--evenly', classes: 'controls controls--evenly' },
    ],
  },
  {
    title: 'Spacing & flow',
    variants: [
      { label: 'controls--tight', classes: 'controls controls--tight' },
      { label: 'controls--roomy', classes: 'controls controls--roomy' },
      { label: 'controls--nowrap', classes: 'controls controls--nowrap' },
      { label: 'controls--stretch', classes: 'controls controls--stretch' },
    ],
  },
];

const iconSizes = [
  { label: 'Small icon', classes: 'media-icon media-icon--small', kind: 'star' },
  { label: 'Default icon', classes: 'media-icon', kind: 'palette' },
  { label: 'Large icon', classes: 'media-icon media-icon--large', kind: 'sparkles' },
];

const iconCatalog = Object.keys(ICON_REGISTRY).sort((a, b) => a.localeCompare(b));

const mediaThumbs = [
  { alt: 'Placeholder cover', src: COVERS.placeholder },
  { alt: 'Lucys Journeys cover', src: COVERS.lucys_journeys },
  { alt: 'Placeholder cover duplicate', src: COVERS.placeholder },
];

const mascotGallery = [
  {
    id: 'mascot-v1',
    label: 'Mascot (Hero render)',
    asset: ASSETS.mascot,
    token: 'ASSETS.mascot',
    description: 'Original hero render used throughout the landing + blog hero cards.',
  },
];

const chapters = [
  'Launch prep',
  'Golden-hour ascent',
  'Nebula glide',
  'Night docking',
  'Tiny paw notes',
];

const blogDemoChapters = chapters.map((title, index) => {
  const slug = title
    .toLowerCase()
    .replace(/[^\p{Letter}\p{Number}]+/gu, '-')
    .replace(/(^-|-$)+/g, '');

  return {
    id: slug || `chapter-${index + 1}`,
    title,
    summary: index === 0 ? 'Crew check-in and warmup.' : undefined,
  };
});

const sampleBlog = {
  title: 'Rocket Lucy — Launch Day',
  description: 'How a cozy launch sequence sets up the whole journey.',
  introParagraphs: [
    'A short, readable summary that mirrors the real blog entry layout.',
    'Shows how badges, overlays and the hero cover look with default spacing.',
  ],
  cover: COVERS.lucys_journeys,
  chapters: blogDemoChapters,
};

const SampleBlogContent = () => (
  <>
    {blogDemoChapters.map((chapter, index) => (
      <section id={chapter.id}>
        <h3>{chapter.title}</h3>
        <p>
          {index === 0
            ? 'Lucy and the ground crew sync their checklists, making sure every system glows green before the climb.'
            : 'A calm narrative paragraph to mirror the live blog layout without any extra styling.'}
        </p>
        <p>
          The prose uses the global `.prose` rhythm from <code>styles/typography.css</code> so this preview matches the
          production article pages.
        </p>
      </section>
    ))}
  </>
);

const albumPreview = {
  title: 'Eurofurence 2024 — Berlin, DE',
  description: 'Live gallery layout with badges, controls and hero frame pulled straight from the album page.',
  shareKey: 'demo-share',
  albumSlug: 'eurofurence-2024',
  categoryBadge: 'Conventions',
  dateBadge: 'August 2024',
  initialThumb: {
    src: COVERS.conventions.src,
    width: COVERS.conventions.width,
    height: COVERS.conventions.height,
    alt: 'Crowded convention hallway with Lucy posing',
    full: COVERS.conventions.src,
  },
};
---
<Template.Base>
  <section class="content-section">
    <Template.Card class="card--plain card--center card--condense">
      <Fragment slot="head">
        <h1 class="card__title">UI Test Bench</h1>
      </Fragment>
      <Fragment slot="body">
        <div class="prose">
          <p>
            Every global token, surface and control style can be inspected here. Hover, focus and click elements to
            review how the shared transitions, glows and shadows behave.
          </p>
        </div>
      </Fragment>
      <Fragment slot="foot">
        <div class="controls controls--center controls--tight">
          {navSections.map((section) => (
            <a class="control control--button" href={`#${section.id}`}>
              {section.label}
            </a>
          ))}
        </div>
      </Fragment>
    </Template.Card>
  </section>

  <section class="content-section" id="entry-layouts">
    <Template.Card class="card--plain" headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Entry layout previews</h2>
        <p>
          Direct renderings of the existing blog and album layouts, using only the shared styles from
          <code>app/src/styles</code>. These blocks mirror the live entry pages without any test-page-only CSS.
        </p>
      </Fragment>
    </Template.Card>
  </section>

  <Template.EntryBlog blog={sampleBlog} BlogContent={SampleBlogContent} />

  <section class="content-section content-section--masonry" id="album-layout-preview">
    <Template.Card class="card--center" headClass="card__head--column">
      <Fragment slot="head">
        {albumPreview.title && (
          <h1 class="card__title">{albumPreview.title}</h1>
        )}

        {(albumPreview.categoryBadge || albumPreview.dateBadge) && (
          <div class="card__badges controls controls--center">
            {albumPreview.categoryBadge && (
              <span class="control control--badge">{albumPreview.categoryBadge}</span>
            )}

            {albumPreview.dateBadge && (
              <span class="control control--badge">{albumPreview.dateBadge}</span>
            )}
          </div>
        )}
      </Fragment>

      <Fragment slot="body">
        {albumPreview.description ? (
          <div class="prose">
            <p>{albumPreview.description}</p>
          </div>
        ) : null}
        <Template.MediaFrame album={albumPreview} />
      </Fragment>
    </Template.Card>

    <Template.Card class="card--flush card--center">
      <Fragment slot="foot">
        <Template.MediaThumbs />
      </Fragment>
    </Template.Card>
  </section>

  <section class="content-section" id="foundation">
    <Template.Card class="card--plain" headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Foundation tokens</h2>
        <p>Spacing, color, motion and FX variables that drive every component.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="token-grid">
          {tokenGroups.map((group) => (
            <div class="token-card">
              <div class="token-card__head">
                <h3>{group.title}</h3>
                <p>{group.description}</p>
              </div>
              <div class="token-card__list">
                {group.items.map((item) => (
                  <div class:list={["token-pill", item.swatch && 'token-pill--has-swatch']}>
                    <div class="token-pill__meta">
                      <strong>{item.label}</strong>
                    </div>
                    <div class="token-pill__tokens">
                      {item.tokens.map((token) => (
                        <code class="token-chip">{token}</code>
                      ))}
                    </div>
                    {item.swatch && <span class="token-chip token-chip--swatch" style={`--token-color: var(${item.swatch})`} />}
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      </Fragment>
    </Template.Card>
  </section>

  <section class="content-section cols-2" id="shadows">
    <Template.Card headClass="card__head--column" class="card--condense">
      <Fragment slot="head">
        <h2 class="card__title">Surface shadows</h2>
        <p>Tokens that set depth cues for cards, media and controls.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="swatch-grid">
          {surfaceEffects.map((effect) => (
            <div class="swatch" id={effect.id}>
              <div class:list={["shadow-preview", effect.preview]} aria-hidden="true"></div>
              <div class="swatch__meta">
                <strong>{effect.label}</strong>
                <code>{effect.token}</code>
                <p>{effect.description}</p>
              </div>
            </div>
          ))}
        </div>
      </Fragment>
    </Template.Card>

    <Template.Card headClass="card__head--column" class="card--condense">
      <Fragment slot="head">
        <h2 class="card__title">Text glow stack</h2>
        <p>Glows & shadows layered onto copy and iconography.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="swatch-grid">
          {textEffects.map((effect) => (
            <div class="swatch">
              <div class={effect.className}>
                <span>Glowing text</span>
              </div>
              <div class="swatch__meta">
                <strong>{effect.label}</strong>
                <p>{effect.description}</p>
              </div>
            </div>
          ))}
        </div>
      </Fragment>
    </Template.Card>
  </section>

  <section class="content-section" id="cards">
    <Template.Card class="card--plain" headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Card variations</h2>
        <p>Core `Template.Card` surfaces with utility modifiers.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="card-grid">
          {cardVariants.map((variant) => (
            <Template.Card class={`${variant.classes} showcase-card`} headClass="card__head--column card--center">
              <Fragment slot="head">
                <h3 class="card__title">{variant.title}</h3>
              </Fragment>
              <Fragment slot="body">
                {variant.showMedia ? (
                  <div class="media-wrapper">
                    <div class="media-frame">
                      <Picture
                        src={COVERS.lucys_journeys}
                        formats={["webp"]}
                        inferSize
                        alt="Lucy looking into the stars"
                        class="media-image"
                      />
                    </div>
                  </div>
                ) : (
                  <div class="prose">
                    <p>{variant.note}</p>
                  </div>
                )}
              </Fragment>
              {!variant.showMedia && (
                <Fragment slot="foot">
                  <p class="showcase-card__note">{formatClassList(variant.classes, 'default card')}</p>
                </Fragment>
              )}
            </Template.Card>
          ))}
        </div>
      </Fragment>
    </Template.Card>
  </section>

  <section class="content-section cols-2" id="controls">
    <Template.Card headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Button variants</h2>
        <p>All button skins, hover glows and icon treatments.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="control-grid">
          {buttonVariants.map((variant) => (
            <div class="control-swatch">
              <span class={variant.classes}>
                {variant.icon ? <Icons class="media-icon" kind={variant.icon} /> : variant.label}
              </span>
              <div class="control-swatch__meta">
                <strong>{variant.label}</strong>
                <p>{variant.description}</p>
                <code>{formatClassList(variant.classes)}</code>
              </div>
            </div>
          ))}
        </div>
      </Fragment>
    </Template.Card>

    <Template.Card headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Sizes & shapes</h2>
        <p>Scale, stretch and circle helpers applied to controls.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="control-grid">
          {buttonSizes.map((variant) => (
            <div class="control-swatch">
              <span class={variant.classes}>
                {variant.icon ? <Icons class="media-icon" kind={variant.icon} /> : variant.label}
              </span>
              <div class="control-swatch__meta">
                <strong>{variant.label}</strong>
                <code>{formatClassList(variant.classes)}</code>
              </div>
            </div>
          ))}
        </div>
      </Fragment>
    </Template.Card>
  </section>

  <section class="content-section cols-2" id="layouts">
    <Template.Card headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Badges & states</h2>
        <p>Lightweight info tags and their interactive styles.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="control-grid">
          {badgeVariants.map((variant) => (
            <div class="control-swatch">
              <span class={variant.classes}>meta</span>
              <div class="control-swatch__meta">
                <strong>{variant.label}</strong>
                <code>{formatClassList(variant.classes)}</code>
              </div>
            </div>
          ))}
        </div>
      </Fragment>
    </Template.Card>

    <Template.Card headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Control layout helpers</h2>
        <p>Alignment & gap utilities applied to `.controls` containers.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="layout-grid">
          {layoutGroups.map((group) => (
            <div class="layout-group">
              <h3>{group.title}</h3>
              {group.variants.map((variant) => (
                <div class="layout-group__row">
                  <div class="layout-group__label">{variant.label}</div>
                  <div class={variant.classes}>
                    <span class="control control--button control--small">Alpha</span>
                    <span class="control control--button">Beta</span>
                    <span class="control control--button control--plain">Gamma</span>
                  </div>
                </div>
              ))}
            </div>
          ))}
        </div>
      </Fragment>
    </Template.Card>
  </section>

  <section class="content-section cols-2" id="media">
    <Template.Card headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Media player shell</h2>
        <p>Gallery frame with interactive controls and progress indicator.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="media-wrapper">
          <div class="media-frame">
            <Picture
              src={COVERS.lucys_journeys}
              formats={["webp"]}
              inferSize
              alt="Starry fox illustration"
              class="media-image"
            />
            <div class="media-progress" style="--p: .45;"></div>
          </div>
          <div class="control control--button control--circle control--media-tray">
            <button class="control control--button control--circle control--media media-prev" type="button" aria-label="Previous frame">❮</button>
            <button class="control control--button control--circle control--media media-pause" type="button" data-active="true" aria-label="Pause autoplay">
              <Icons class="media-icon" kind="pause" />
            </button>
            <button class="control control--button control--circle control--media media-play" type="button" data-active="false" aria-label="Start autoplay">
              <Icons class="media-icon" kind="play" />
            </button>
            <button class="control control--button control--circle control--media media-next" type="button" aria-label="Next frame">❯</button>
            <button class="control control--button control--circle control--media media-fullscreen" type="button" aria-label="Open lightbox">
              <Icons class="media-icon" kind="fullscreen" />
            </button>
          </div>
        </div>
      </Fragment>
    </Template.Card>

    <Template.Card headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Mascot renders</h2>
        <p>Reference imagery for `.media-frame` and `.media-image` tokens.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="mascot-gallery">
          {mascotGallery.map((mascot) => (
            <div class="mascot-card" id={mascot.id}>
              <div class="media-frame">
                <Picture src={mascot.asset} formats={["webp"]} inferSize alt={mascot.label} class="media-image" />
              </div>
              <div class="mascot-card__meta">
                <strong>{mascot.label}</strong>
                <p>{mascot.description}</p>
                <code>{mascot.token}</code>
              </div>
            </div>
          ))}
        </div>
      </Fragment>
    </Template.Card>

    <Template.Card headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Thumbnail rail & icons</h2>
        <p>Thumbnails, wrappers and icon sizing utilities.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="media-wrapper media-wrapper--thumbs">
          <button class="control control--button control--circle control--media media-prev is-thumbs-prev" type="button" aria-label="Previous thumbnails">❮</button>
          <div class="media-thumbs">
            {mediaThumbs.map((thumb, index) => (
              <div class={['media-frame', index === 1 ? 'media-frame--current' : '']}>
                <Picture src={thumb.src} formats={["webp"]} inferSize alt={thumb.alt} class="media-image" />
              </div>
            ))}
          </div>
          <button class="control control--button control--circle control--media media-next is-thumbs-next" type="button" aria-label="Next thumbnails">❯</button>
        </div>

        <div class="icon-section">
          <p class="icon-section__title">Icon sizes</p>
          <div class="icon-grid icon-grid--sizes">
            {iconSizes.map((icon) => (
              <div class="icon-grid__item">
                <Icons class={icon.classes} kind={icon.kind} />
                <span>{formatClassList(icon.classes)}</span>
              </div>
            ))}
          </div>

          <p class="icon-section__title">Icon catalog</p>
          <div class="icon-grid icon-grid--catalog">
            {iconCatalog.map((iconKey) => (
              <div class="icon-grid__item icon-grid__item--catalog">
                <Icons class="media-icon" kind={iconKey as keyof typeof ICON_REGISTRY} />
                <span>{iconKey}</span>
              </div>
            ))}
          </div>
        </div>
      </Fragment>
    </Template.Card>
  </section>

  <section class="content-section" id="typography">
    <Template.Card headClass="card__head--column">
      <Fragment slot="head">
        <h2 class="card__title">Typography, prose & helpers</h2>
        <p>Examples of `.prose`, italic treatments and balanced headings.</p>
      </Fragment>
      <Fragment slot="body">
        <div class="typography-grid">
          <div>
            <h3 class="card__title">Balanced heading</h3>
            <div class="prose">
              <p>
                Fox companions help travellers find their way home. The copy stack uses `prose` spacing and inherits the
                soft text glow token.
              </p>
              <ul>
                <li>Responsive clamp-based font sizing.</li>
                <li>Drop shadow applied to each paragraph.</li>
                <li>Comfortable flow gaps between blocks.</li>
              </ul>
            </div>
          </div>
          <div>
            <h3 class="card__title">Utility mix</h3>
            <p class="is-italic">`.is-italic` for emphasis quotes.</p>
            <Template.Card class="card--plain card--condense showcase-card">
              <Fragment slot="head">
                <h4 class="card__title">Embedded plain card</h4>
              </Fragment>
              <Fragment slot="body">
                <div class="prose">
                  <p>Cards can be nested to preview combinations of utilities.</p>
                </div>
              </Fragment>
            </Template.Card>
          </div>
        </div>
      </Fragment>
    </Template.Card>
  </section>

  <style>
    .token-grid {
      display: grid;
      gap: var(--section-gap);
      grid-template-columns: repeat(auto-fit, minmax(18rem, 1fr));
    }
    .token-card {
      display: grid;
      gap: var(--flow-gap);
    }

    .token-card__head h3 {
      margin: 0;
    }

    .token-card__head p {
      margin: 0;
      font-size: var(--font-size-xs);
      opacity: 0.85;
    }

    .token-card__list {
      display: grid;
      gap: var(--flow-gap);
    }

    .token-pill {
      display: grid;
      gap: calc(var(--flow-gap) * 0.35);
      align-items: center;
      grid-template-columns: 1fr;
      padding: calc(var(--control-padding) * 0.9);
      border-radius: var(--radius-l);
      border: 1px solid color-mix(in oklab, var(--card-border) 65%, transparent);
      background: color-mix(in oklab, var(--color-light--ghosty) 35%, transparent);
    }

    .token-pill--has-swatch {
      grid-template-columns: 1fr auto;
      align-items: start;
    }

    .token-pill__meta {
      display: grid;
      gap: calc(var(--flow-gap) * 0.25);
      font-size: var(--font-size-xs);
    }

    .token-pill__tokens {
      display: flex;
      flex-wrap: wrap;
      gap: calc(var(--flow-gap) * 0.5);
      align-items: center;
    }

    .token-chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      padding: 0.25rem 0.65rem;
      border-radius: 999px;
      background: color-mix(in oklab, var(--color-dark--soft) 60%, transparent);
      border: 1px solid color-mix(in oklab, var(--card-border) 60%, transparent);
      font-size: var(--font-size-xs);
      white-space: nowrap;
      text-align: center;
    }

    .token-chip--swatch {
      inline-size: 2rem;
      block-size: 2rem;
      padding: 0;
      border-radius: var(--radius-m);
      background: var(--token-color);
      border: 1px solid color-mix(in oklab, var(--color-dark) 20%, transparent);
    }

    .swatch-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(15rem, 1fr));
      gap: var(--flow-gap);
    }

    .swatch {
      display: grid;
      gap: calc(var(--flow-gap) * 0.75);
    }

    .shadow-preview {
      inline-size: 100%;
      block-size: 6rem;
      border-radius: var(--radius-l);
      background: color-mix(in oklab, var(--color-light--ghosty) 80%, transparent);
      box-shadow: var(--fx-shadow--soft);
    }

    .shadow-preview--surface-soft { box-shadow: var(--fx-shadow--soft); }
    .shadow-preview--surface-default { box-shadow: var(--fx-shadow); }
    .shadow-preview--surface-strong { box-shadow: var(--fx-shadow--strong); }

    .text-preview {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--control-padding);
      border-radius: var(--radius-m);
      min-block-size: 4rem;
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-m);
      background: color-mix(in oklab, var(--color-dark--soft) 40%, transparent);
    }

    .text-preview--soft { text-shadow: var(--text-shadow), var(--text-glow); }
    .text-preview--strong { text-shadow: var(--text-shadow), var(--text-glow); }
    .text-preview--icon {
      text-shadow: var(--icon-shadow);
    }

    .swatch__meta {
      display: grid;
      gap: calc(var(--flow-gap) * 0.35);
      font-size: var(--font-size-xs);
    }

    .swatch__meta > strong {
      font-size: var(--font-size-s);
    }

    .card-grid {
      display: grid;
      gap: var(--section-gap);
      grid-template-columns: repeat(auto-fit, minmax(18rem, 1fr));
    }

    .showcase-card {
      min-block-size: 100%;
    }

    .showcase-card__note {
      margin: 0;
      font-size: var(--font-size-xs);
      opacity: 0.8;
    }

    .control-grid {
      display: grid;
      gap: var(--flow-gap);
      grid-template-columns: repeat(auto-fit, minmax(16rem, 1fr));
    }

    .control-swatch {
      display: grid;
      gap: calc(var(--flow-gap) * 0.5);
      align-content: start;
    }

    .control-swatch > span {
      justify-self: start;
    }

    .control-swatch__meta {
      display: grid;
      gap: calc(var(--flow-gap) * 0.35);
      font-size: var(--font-size-xs);
    }

    .layout-grid {
      display: grid;
      gap: var(--section-gap);
    }

    .layout-group {
      display: grid;
      gap: var(--flow-gap);
    }

    .layout-group__row {
      display: grid;
      gap: calc(var(--flow-gap) * 0.35);
    }

    .layout-group__label {
      font-size: var(--font-size-xs);
      opacity: 0.8;
    }

    .layout-group__row > .controls {
      background: color-mix(in oklab, var(--color-light--ghosty) 40%, transparent);
      padding: calc(var(--control-padding) * 0.75);
      border-radius: var(--radius-l);
    }

    .control--media-tray {
      display: flex;
      flex-wrap: wrap;
      gap: calc(var(--control-gap) * 0.75);
      justify-content: center;
      padding: var(--control-padding);
    }

    .icon-section {
      display: grid;
      gap: calc(var(--flow-gap) * 0.75);
    }

    .mascot-gallery {
      display: grid;
      gap: var(--flow-gap);
      grid-template-columns: repeat(auto-fit, minmax(18rem, 1fr));
    }

    .mascot-card {
      display: grid;
      gap: calc(var(--flow-gap) * 0.5);
    }

    .mascot-card__meta {
      display: grid;
      gap: calc(var(--flow-gap) * 0.25);
      font-size: var(--font-size-xs);
    }

    .icon-section__title {
      margin: 0;
      font-size: var(--font-size-s);
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.8;
    }

    .icon-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(8rem, 1fr));
      gap: var(--flow-gap);
      margin-block-start: var(--flow-gap);
    }

    .icon-grid--sizes {
      margin-block-start: 0;
      grid-template-columns: repeat(auto-fit, minmax(10rem, 1fr));
    }

    .icon-grid--catalog {
      grid-template-columns: repeat(auto-fit, minmax(6.5rem, 1fr));
    }

    .icon-grid__item {
      display: grid;
      gap: calc(var(--flow-gap) * 0.35);
      justify-items: center;
      font-size: var(--font-size-xs);
    }

    .icon-grid__item--catalog {
      padding: calc(var(--control-padding) * 0.75) calc(var(--control-padding) * 0.5);
      border-radius: var(--radius-m);
      background: color-mix(in oklab, var(--color-light--ghosty) 32%, transparent);
    }

    .icon-grid__item--catalog > span {
      word-break: break-word;
      text-align: center;
      line-height: 1.25;
    }

    .typography-grid {
      display: grid;
      gap: var(--section-gap);
      grid-template-columns: repeat(auto-fit, minmax(20rem, 1fr));
    }

    .typography-grid .prose {
      margin-block-start: 0;
    }

    @media (max-width: 900px) {
      .control--media-tray {
        justify-content: space-between;
      }
    }
  </style>
</Template.Base>
