---
import { Template } from '@Frontend';
import { PLACEHOLDER_COVER } from '@Assets/covers';
import { getEntriesBySectionAndCategory } from '@utils/getEntries';
import { createBlogEntryView, matchesEntrySlug } from '@utils/entryTransforms';
import type { CollectionEntry } from 'astro:content';

const placeholderCover = PLACEHOLDER_COVER.src;

// ðŸ‘‰ Hier stellst du ein, welchen Blog-Entry du testen willst:
const sectionSlug = 'tails';
const categorySlug = 'lucys-journeys';
const slug = 'tails-lucys-journeys-starlit-liftoff';

let errorMessage: string | undefined;

const entries = await getEntriesBySectionAndCategory(sectionSlug, categorySlug);
const entry = entries.find((candidate) => matchesEntrySlug(candidate, slug));

let blogView: ReturnType<typeof createBlogEntryView>['blog'] | undefined;
let BlogContent: Awaited<
  ReturnType<CollectionEntry<'blog'>['render']>
>['Content'] | undefined;

if (!entry) {
  errorMessage = 'We could not find that entry yet. Please check back soon!';
} else {
  // Parent-URL einfach selber bauen, wir brauchen sie nur fÃ¼r Back-Link / Header
  const parentHref = `/${sectionSlug}/${categorySlug}/`;

  const rendered = await entry.render();
  BlogContent = rendered.Content;

  const blogData = createBlogEntryView(entry, parentHref, {
    categorySlug,
    categoryDescription: undefined,
    parentPage: undefined,
    placeholderCover,
  });

  blogView = blogData.blog;
}
---

<Template.Base title="Entry layout test">
  <section class="content-section">
    <Template.Card class="card--center card--plain">
      <Fragment slot="body">
        <nav class="controls controls--tight controls--center">
          <a class="control control--button control--small" href="#variant-a">Variante A â€“ Hero Full</a>
          <a class="control control--button control--small" href="#variant-b">Variante B â€“ Hero Compact</a>
          <a class="control control--button control--small" href="#variant-c">Variante C â€“ Split Header</a>
          <a class="control control--button control--small" href="#variant-d">Variante D â€“ Clean Header</a>
          <a class="control control--button control--small" href="#variant-e">Variante E â€“ Rail Layout</a>
        </nav>
      </Fragment>
    </Template.Card>
  </section>
  {errorMessage ? (
    <section class="content-section">
      <Template.Card class="card--center">
        <Fragment slot="body">
          <p>{errorMessage}</p>
        </Fragment>
      </Template.Card>
    </section>
  ) : blogView && BlogContent ? (
    <>



      {/***** Variante A: heroFull *****/}
      <section class="content-section" id="variant-a">
        <Template.Card class="card--center card--plain">
          <Fragment slot="head">
            <h2 class="card__title">Variante A: heroFull</h2>
          </Fragment>
        </Template.Card>
      </section>

      <Template.EntryBlogHeroFull
        blog={{
          title: blogView.title,
          description: blogView.description,
          introParagraphs: blogView.introParagraphs,
          cover: blogView.cover,
          chapters: blogView.chapters,
          date: entry?.data?.date,
          category: entry?.data?.category,
        }}
        BlogContent={BlogContent}
      />

      {/***** Variante B: heroCompact *****/}
      <section class="content-section" id="variant-b">
        <Template.Card class="card--center card--plain">
          <Fragment slot="head">
            <h2 class="card__title">Variante B: heroCompact</h2>
          </Fragment>
        </Template.Card>
      </section>

      <Template.EntryBlogHeroCompact
        blog={{
          title: blogView.title,
          description: blogView.description,
          introParagraphs: blogView.introParagraphs,
          cover: blogView.cover,
          chapters: blogView.chapters,
          date: entry?.data?.date,
          category: entry?.data?.category,
        }}
        BlogContent={BlogContent}
      />
 
      {/***** Variante C: splitHeader *****/}
      <section class="content-section" id="variant-c">
        <Template.Card class="card--center card--plain">
          <Fragment slot="head">
            <h2 class="card__title">Variante C: splitHeader</h2>
          </Fragment>
        </Template.Card>
      </section>

      <Template.EntryBlogSplitHeader
        blog={{
          title: blogView.title,
          description: blogView.description,
          introParagraphs: blogView.introParagraphs,
          cover: blogView.cover,
          chapters: blogView.chapters,
          date: entry?.data?.date,
          category: entry?.data?.category,
        }}
        BlogContent={BlogContent}
      />

      {/***** Variante D: cleanHeader *****/}
      <section class="content-section" id="variant-d">
        <Template.Card class="card--center card--plain">
          <Fragment slot="head">
            <h2 class="card__title">Variante D â€“ CleanHeader</h2>
          </Fragment>
        </Template.Card>
      </section>

      <Template.EntryBlogCleanHeader
        blog={{
          title: blogView.title,
          description: blogView.description,
          introParagraphs: blogView.introParagraphs,
          cover: blogView.cover,
          chapters: blogView.chapters,
          date: entry?.data?.date,
          category: entry?.data?.category,
        }}
        BlogContent={BlogContent}
      />

      {/***** Variante E: railLayout *****/}
      <section class="content-section" id="variant-e">
        <Template.Card class="card--center card--plain">
          <Fragment slot="head">
            <h2 class="card__title">Variante E: railLayout</h2>
          </Fragment>
        </Template.Card>
      </section>

      <Template.EntryBlogRailLayout
        blog={{
          title: blogView.title,
          description: blogView.description,
          introParagraphs: blogView.introParagraphs,
          cover: blogView.cover,
          chapters: blogView.chapters,
          date: entry?.data?.date,
          category: entry?.data?.category,
        }}
        BlogContent={BlogContent}
      />

                             
    </>
  ) : null}
</Template.Base>
