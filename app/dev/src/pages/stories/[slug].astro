---
import Layout from '@Layout/Main.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { getPageContent } from '@Content/siteContent';

export async function getStaticPaths() {
  const stories = await getCollection('stories');
  return stories.map((story) => ({
    params: { slug: story.slug },
    props: { story },
  }));
}

const { story } = Astro.props as { story: CollectionEntry<'stories'> };
const parentPage = await getPageContent('stories');
const { Content } = await story.render();

const formatDate = (date: Date) => new Intl.DateTimeFormat('en', { dateStyle: 'medium' }).format(date);
const meta = {
  title: `${story.data.title} | ${parentPage.title}`,
  description: story.data.description ?? parentPage.description,
};
---
<Layout title={story.data.title} meta={meta}>
  <article class="content-card section">
    <div class="content-card__title">
      <h1>{story.data.title}</h1>
      <p>
        <strong>Published:</strong> {formatDate(story.data.publishDate)}
        {story.data.updatedDate && (
          <>
            <br />
            <strong>Updated:</strong> {formatDate(story.data.updatedDate)}
          </>
        )}
        {story.data.categories?.length && (
          <>
            <br />
            <strong>Categories:</strong> {story.data.categories.join(', ')}
          </>
        )}
        {story.data.tags?.length && (
          <>
            <br />
            <strong>Tags:</strong> {story.data.tags.join(', ')}
          </>
        )}
      </p>
    </div>
    <div class="prose">
      <Content />
    </div>
    <p>
      <a href="/stories">‚Üê Back to all stories</a>
    </p>
  </article>
</Layout>
