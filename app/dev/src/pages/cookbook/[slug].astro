---
import Layout from '@Layout/Main.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { getPageContent } from '@Content/siteContent';
import Card from '@Layout/Card.astro';

export async function getStaticPaths() {
  const recipes = await getCollection('recipes');
  return recipes.map((recipe) => ({
    params: { slug: recipe.slug },
    props: { recipe },
  }));
}

const { recipe } = Astro.props as { recipe: CollectionEntry<'recipes'> };
const parentPage = await getPageContent('cookbook');
const { Content } = await recipe.render();

const formatDate = (date: Date) => new Intl.DateTimeFormat('en', { dateStyle: 'medium' }).format(date);
const meta = {
  title: `${recipe.data.title} | ${parentPage.title}`,
  description: recipe.data.description ?? parentPage.description,
};
---
<Layout title={recipe.data.title} meta={meta}>
  <article class="content-section">
    <Card headClass="card__head--column">
      <Fragment slot="head">
        <h1 class="card__title">{recipe.data.title}</h1>
        {(recipe.data.categories?.length || recipe.data.tags?.length) && (
          <div class="card__badges controls controls--tight">
            {recipe.data.categories?.map((category) => (
              <span class="badge badge--dark">{category}</span>
            ))}
            {recipe.data.tags?.map((tag) => (
              <span class="badge">{tag}</span>
            ))}
          </div>
        )}
      </Fragment>
      <Fragment slot="body">
        <p>
          <strong>Published:</strong> {formatDate(recipe.data.publishDate)}
          {recipe.data.updatedDate && (
            <>
              <br />
              <strong>Updated:</strong> {formatDate(recipe.data.updatedDate)}
            </>
          )}
        </p>
        <div class="prose">
          {(recipe.data.prepTime || recipe.data.cookTime || recipe.data.servings) && (
            <ul>
              {recipe.data.prepTime && (
                <li>
                  <strong>Prep:</strong> {recipe.data.prepTime}
                </li>
              )}
              {recipe.data.cookTime && (
                <li>
                  <strong>Cook:</strong> {recipe.data.cookTime}
                </li>
              )}
              {recipe.data.servings && (
                <li>
                  <strong>Serves:</strong> {recipe.data.servings}
                </li>
              )}
            </ul>
          )}
          <Content />
        </div>
      </Fragment>
      <Fragment slot="foot">
        <div class="controls controls--start">
          <a class="button button--ghost" href="/cookbook">‚Üê Back to the cookbook</a>
        </div>
      </Fragment>
    </Card>
  </article>
</Layout>
