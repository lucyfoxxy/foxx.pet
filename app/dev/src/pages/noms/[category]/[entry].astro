---
import { View } from '@Frontend';
import { getEntriesBySection, isAlbumEntry } from '@utils/getEntries';

export async function getStaticPaths() {
  const entries = await getEntriesBySection('noms');

  return entries
    .filter((entry) => !isAlbumEntry(entry))
    .map((entry) => {
      const segments = entry.slug.split('/').filter(Boolean);
      const entrySegment = segments[segments.length - 1] ?? entry.data.slug ?? entry.slug;
      const categorySegment = entry.data.category ?? 'general';

      return {
        params: {
          category: categorySegment,
          entry: entrySegment,
        },
      };
    });
}

const { entry } = Astro.params;

if (!entry) {
  throw new Error('Missing blog article slug');
}
---
<View.Entry section="noms" slug={entry} />
