---
import { getCollection, getEntry } from 'astro:content';
import Layout from '@Layout/Main.astro';
import GalleryCategoryOverviewPage from '@Pages/Gallery/CategoryOverviewPage.astro';

export async function getStaticPaths() {
  const catalog = (await getEntry('galleryCatalog', 'categories')).data;
  return catalog.categories
    .filter((c) => c.slug)
    .map((c) => ({
      params: { slug: c.slug! },
      props:  { title: c.title, description: c.description ?? '' },
    }));
}

const { slug } = Astro.params;
const { title, description } = Astro.props as { title?: string; description?: string };
const meta = {
  title: title ?? 'Gallery',
  description: description ?? '',
};

const albums = await getCollection('albumData', ({ data }) => (data.category?.slug ?? '') === slug);
const albumEntries = albums.map(({ data }) => ({
  slug: data.slug,
  title: data.title ?? data.albumName ?? data.slug,
  description:
    data.albumName && data.albumName !== data.title
      ? data.albumName
      : undefined,
  count: data.count,
}));

const category = { slug, title: meta.title, description: meta.description };
const backHref = '/galleries';
const backLabel = '‚Üê Back to Paw Prints';
---
<Layout title={meta.title} meta={meta}>
  <Fragment slot="breadcrumbs-actions">
    <a class="button button--small" href={backHref}>{backLabel}</a>
  </Fragment>
  <GalleryCategoryOverviewPage category={category} albums={albumEntries} />
</Layout>
