---
/**
 * Reusable tile for SubcategoryOverview lists (albums & articles).
 * Kapselt Card-Layout, Headline, Cover-Darstellung und Badges.
 */
import { Template } from '@Frontend';
import type { HTMLAttributes, HTMLTag } from 'astro/types';

type Props = {
  href: string;
  title: string;
  description?: string;
  dataSlug?: string;
  class?: HTMLAttributes<HTMLTag>['class'];
  headClass?: HTMLAttributes<HTMLTag>['class'];
  ariaLabel?: string;
  cover?: string;
  coverAlt?: string;
  date?: Date | string;
  count?: number;
  countLabel?: string;
};

const props = Astro.props as Props;

// Default styling helpers
const defaultCardClass = 'is-centered is-animated';

const headColumnClass = 'card__head--column';

const aria = props.ariaLabel ?? `View ${props.title}`;

const formattedDate =
  props.date instanceof Date
    ? new Intl.DateTimeFormat('en', { dateStyle: 'medium' }).format(props.date)
    : typeof props.date === 'string' && props.date.trim().length
    ? props.date
    : undefined;

const hasCount = typeof props.count === 'number';
const normalizedCountLabel = props.countLabel?.trim().length
  ? props.countLabel!.trim()
  : undefined;
const formattedCount = hasCount
  ? normalizedCountLabel
    ? `${normalizedCountLabel}: ${props.count ?? 0}`
    : props.count! > 0
    ? `${props.count} photos`
    : 'No photos yet'
  : undefined;

const imageLoading = 'lazy';
const imageDecoding = 'async';
const imageFetchPriority = 'auto';
const coverAlt = props.coverAlt ?? '';

---

<a href={props.href} aria-label={aria}>
  <Template.Card class={[defaultCardClass, props.class]} headClass={[headColumnClass, props.headClass]}>

    <Fragment slot="head">
      <h2 class="card__title">{props.title}</h2>
    </Fragment>

    <Fragment slot="body">

      {props.description ? <p>{props.description}</p> : null}
    </Fragment>

    <Fragment slot="foot">
      <div class="media-wrapper media-wrapper--roomy">
        <div class="media-frame" data-slug={props.dataSlug}>
          {props.cover ? (
            <img
              src={props.cover}
              alt={coverAlt}
              class="media-image"
              loading={imageLoading}
              decoding={imageDecoding}
              fetchpriority={imageFetchPriority ?? undefined}
            />
          ) : (
            <div class="media-image placeholder" aria-hidden="true"></div>
          )}
        </div>
      </div>
    {formattedDate || formattedCount ? (
      <div class="card__badges controls controls--tight">
        {formattedDate ? <span class="control control--badge control--dark">{formattedDate}</span> : null}
        {formattedCount ? <span class="control control--badge control--dark">{formattedCount}</span> : null}
      </div>
      ) : null }
    </Fragment>

  </Template.Card>
</a>
