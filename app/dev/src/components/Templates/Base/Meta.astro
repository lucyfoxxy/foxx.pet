---
import { ASSETS } from '@Assets/ui';
import { COVERS } from '@Assets/covers';
type LayoutMeta = {
  title: string;
  description: string;
  url: string;
  image?: string;
};

const {
  title = 'foxx.pet',
  description = '',
  url = 'https://foxx.pet',
  image,
} = (Astro.props ?? {}) as Partial<LayoutMeta>;
const imageSrc = image ?? ASSETS.og.src;
const goatCounterBase = 'https://stats.foxx.pet';
const enableAnalytics = true;
const goatCounterScriptSrc = 'https://stats.foxx.pet/count.js';
---

<head>
  <!-- Page metadata -->
  <title>{title}</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content={description} />

  <meta property="og:type" content="website" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={imageSrc} />
  <meta property="og:url" content={url} />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={imageSrc} />

  <link rel="icon" type="image/webp" href={ASSETS.favicon.src} />
  <link rel="preload" href={ASSETS.overlay__stars.src} as="image" type="image/webp" />
  <link rel="preload" href={ASSETS.overlay__nebula.src} as="image" type="image/webp" />
  <link rel="preload" href={ASSETS.bg__panel.src} as="image" type="image/webp" />
  <link rel="preload" href={ASSETS.logo_header.src} as="image" type="image/webp" />
  <link rel="preload" href="/fonts/FuzzyBubbles_400.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="/fonts/FuzzyBubbles_700.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="/fonts/Grandstander_italic_100-900.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="/fonts/Grandstander_normal_100-900.woff2" as="font" type="font/woff2" crossorigin />
</head>
<script>
  const yearEl = document.querySelector('[data-current-year]');
  if (yearEl) {
    yearEl.textContent = new Date().getFullYear().toString();
  }
</script>
{enableAnalytics && (
  <script data-goatcounter={`${goatCounterBase}/count`} async src={goatCounterScriptSrc}></script>
)}
<script>
import _runOnReady from '@Scripts/utils/_runOnReady.js';
import initStarsCanvas from '@Scripts/stars-overlay.js';

const starsRegistry = new WeakMap<HTMLCanvasElement, () => void>();

_runOnReady(() => {
  document
    .querySelectorAll<HTMLCanvasElement>('.panel-shell.has-stars .stars-canvas')
    .forEach((canvas) => {
      const stop = initStarsCanvas(canvas, { density: 0.22, fps: 50, glow: true });
      starsRegistry.set(canvas, stop);
    });
});

// Beispiel Cleanup (wenn du Panels entfernst/Hot-Reload o.Ã¤.):
export function stopStars(canvas: HTMLCanvasElement) {
  const stop = starsRegistry.get(canvas);
  if (stop) stop();
  starsRegistry.delete(canvas);
}

</script>