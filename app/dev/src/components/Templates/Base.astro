---
import '@Styles/tokens.css';
import '@Styles/base.css';
import '@Styles/typography.css';
import '@Styles/site.css';
import '@Styles/site-bars.css';
import '@Styles/content.css';
import '@Styles/controls.css';
import '@Styles/media.css';
import '@Styles/table.css';

import { ASSETS } from '@Assets/assets.registry';
import { getNavigationLinks, getPageContent } from '@Content/siteContent';
import { BaseParts,Template } from '@Frontend';
import { buildBreadcrumbs, isLinkActive, normalizePath } from '@utils/navigation';


// ---------------------------------------------------------------------------
type LayoutMeta = {
  title: string;
  description: string;
  url: string;
  image?: string;
};

type LayoutProps = {
  title?: string;
  meta?: Partial<LayoutMeta>;
};

// ---------------------------------------------------------------------------
// Metadata setup
// ---------------------------------------------------------------------------
const homePage = await getPageContent('home');
const defaultMeta: LayoutMeta = {
  title: homePage.title,
  description: homePage.description,
  url: 'https://foxx.pet',
  image: ASSETS.og.src,
};

const props = (Astro.props ?? {}) as LayoutProps;
const meta: LayoutMeta = {
  ...defaultMeta,
  ...(props.meta ?? {}),
  title: props.title?.trim() || props.meta?.title?.trim() || defaultMeta.title,
};

const { title, description, url, image } = meta;

// ---------------------------------------------------------------------------
// Navigation & breadcrumbs
// ---------------------------------------------------------------------------
const rawNavLinks = await getNavigationLinks();
const currentPath = normalizePath(Astro.url.pathname);
const navLinks = rawNavLinks.map((link) => ({
  ...link,
  isActive: isLinkActive(link.href, currentPath),

}));
const breadcrumbs = buildBreadcrumbs({
  currentPath: Astro.url.pathname,
  navLinks,
  pageTitle: title,
});
---
<html lang="en">
  <BaseParts.Meta title={title} description={description} url={url} image={image} />
  <body style={`
                --overlay-nebula: url(${ASSETS.overlay__nebula.src});
                --overlay-stars: url(${ASSETS.overlay__stars.src});
                --overlay-stars--dense: url(${ASSETS.overlay__stars__dense.src});
                --overlay-header: url(${ASSETS.overlay__header.src});
                --overlay-footer: url(${ASSETS.overlay__footer.src});
                --hero--bg: url(${ASSETS.mascot.src});
              `}>
    
    <div class="container">
      <Template.MediaLightbox />
      <div class="panel-wrapper">

        <BaseParts.Header meta={meta} navLinks={navLinks} >
          {Astro.slots.has('header__actions') ? (
            <slot name="header__actions" slot="actions" />
          ) : null}
        </BaseParts.Header>

        <canvas class="stars-canvas" aria-hidden="true"></canvas>

        <main class="panel">
          <slot />
        </main>

        <BaseParts.Footer breadcrumbs={breadcrumbs}/>

      </div>
    </div>
  </body>
</html>

