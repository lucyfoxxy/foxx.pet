---
import { Template } from '@Frontend';
import Icon from '@Assets/Icons.astro';
import { ASSETS } from '@Assets/ui';
import { getPageContent } from '@Content/siteContent';
import { getRandomAlbumTeaser } from '@utils/albumTeaser';
import '@Styles/sections/startpage.css';

export const prerender = true;

const content = await getPageContent('home');

const meta = {
  title: content.title,
  description: content.description,
};

const hero = {
  ...content.hero,
  logo: ASSETS.mascot_v2,
  image: ASSETS.mascot_v2.src,
};

const intro = content.intro;
const feature = content.feature;
const links = content.contactLinks ?? [];
const contact = content.contact;

const albumData = getRandomAlbumTeaser() ?? null;

const shareKey = 'KEkdKYpvFNPFgS654sbWB28rHuXIohcLo5MtrD1BERFqwHOtrQjmDxMhsRTnRSsKRSw';
const isExternalLink = (href: string) => href.startsWith('http');
---
<Template.Base meta={meta}>
  <head>
    <link rel="preload" href={hero.logo.src} as="image" type="image/webp" />
  </head>

  <section class="content-section content-section--hero">
    <!--- Hero Card --->   
    <Template.Card class="card--plain is-centered is-condensed">
      <Fragment slot="body">
        
        <div class="hero-logo">
          <div class="hero-logo__text">
            <h4 class="hero__signature">Welcome to</h4>
            <h4 class="hero__signature hero__signature--lucy">Lucy's</h4>
          <span class="hero-logo__brand">
            <span class="hero-logo__brand-sub">Cozy Cosmos</span>
          </span>

          <span class="hero-logo__squeak is-italic">
            â€¦ a place full of love and joy 
          </span>
        </div>
      </div>        
      </Fragment>
    </Template.Card>

  <section class="content-section content-section--masonry">
      <!--- Intro Card --->  
      <Template.Card>
        <Fragment slot="head">
          <h2 class="card__title">{intro.heading}</h2>
        </Fragment>
        <Fragment slot="body">
          <div class="prose">
            {intro.paragraphs.map((paragraph) => (
              <p>{paragraph}</p>
            ))}
          </div>
        </Fragment>
        <Fragment slot="foot">
          <div class="prose">
            <p>- Always follow your heart -</p>
            <h4 class="is-italic">{intro.signature}</h4>
          </div>
        </Fragment>
      </Template.Card>

      <!--- Contact Card --->      
      <Template.Card class="" headClass="card__head--column">
        <Fragment slot="head">
          <h2 class="card__title">{contact.heading}</h2>
          <p>{contact.description}</p>
        </Fragment>
        <Fragment slot="body">
          <div class="controls controls--start">
            {links.map((link) => (
              <a
                class="control control--button control--dark control--large control--glow"
                href={link.href}
                rel={isExternalLink(link.href) ? 'noopener noreferrer' : undefined}
                target={isExternalLink(link.href) ? '_blank' : undefined}
              >
                <Icon class="media-icon" kind={link.kind} />
              </a>
            ))}
          </div>
        </Fragment>
      </Template.Card>

      <!--- Feature Card --->  
      <Template.Card class="" headClass="card__head--column">
        <Fragment slot="head">
          <h2 class="card__title">{feature.heading}</h2>
          <p>{feature.description}</p>
        </Fragment>
      </Template.Card>      



      <!--- Album Card --->  
      <Template.AlbumFrame album={albumData} />

  </section>

  <script>
    import initGalleryFrame from '@Scripts/galleryViewer.js';
    import { runOnReady } from '@Scripts/utils/_runOnReady.js';
    runOnReady(initGalleryFrame);
  </script>
</Template.Base>
