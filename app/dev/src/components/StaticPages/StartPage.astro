---
import { Template } from '@Frontend';
import Icon from '@Assets/Icons.astro';
import { ASSETS } from '@Assets/ui';
import { getPageContent } from '@Content/siteContent';
import { getRandomAlbumTeaser } from '@utils/albumTeaser';

export const prerender = true;

const content = await getPageContent('home');

const meta = {
  title: content.title,
  description: content.description,
};

const hero = {
  ...content.hero,
  logo: ASSETS.logo_hero,
  image: ASSETS.logo_hero.src,
};

const intro = content.intro;
const feature = content.feature;
const links = content.contactLinks ?? [];
const contact = content.contact;

const albumData = getRandomAlbumTeaser() ?? null;

const shareKey = 'KEkdKYpvFNPFgS654sbWB28rHuXIohcLo5MtrD1BERFqwHOtrQjmDxMhsRTnRSsKRSw';
const isExternalLink = (href: string) => href.startsWith('http');
---
<Template.Base meta={meta}>
  <head>
    <link rel="preload" href={hero.logo.src} as="image" type="image/webp" />
  </head>

  <section class="content-section content-section--head">
    <Template.Card class="card--plain is-centered is-condensed">
      <Fragment slot="head">
        <h1 class="card__title">{hero.heading}</h1>
      </Fragment>
      <Fragment slot="body">
        <img
          src={hero.logo.src}
          alt={hero.heading}
          loading='eager'
          fetchpriority="high"
          class="media-image hero"
        />
      </Fragment>
      <Fragment slot="foot">
        <h2>
          <em>...Eeeeeeeeeeeeeeeeeeeeek!</em>
        </h2>
      </Fragment>
    </Template.Card>
  </section>

  <section class="content-section cols-2">
    <section class="content-section">
      <Template.Card>
        <Fragment slot="head">
          <h2 class="card__title">{intro.heading}</h2>
        </Fragment>
        <Fragment slot="body">
          <div class="prose">
            {intro.paragraphs.map((paragraph) => (
              <p>{paragraph}</p>
            ))}
          </div>
        </Fragment>
        <Fragment slot="foot">
          <div class="prose">
            <p>- Always follow your heart -</p>
            <h3 class="is-italic">{intro.signature}</h3>
          </div>
        </Fragment>
      </Template.Card>
      <Template.Card class="" headClass="card__head--column">
        <Fragment slot="head">
          <h2 class="card__title">{contact.heading}</h2>
          <p>{contact.description}</p>
        </Fragment>
        <Fragment slot="body">
          <div class="controls controls--start">
            {links.map((link) => (
              <a
                class="control control--button control--dark control--large control--glow control--animated"
                href={link.href}
                rel={isExternalLink(link.href) ? 'noopener noreferrer' : undefined}
                target={isExternalLink(link.href) ? '_blank' : undefined}
              >
                <Icon class="media-icon" kind={link.kind} />
              </a>
            ))}
          </div>
        </Fragment>
      </Template.Card>
    </section>

    <section class="content-section">
      <Template.Card class="" headClass="card__head--column">
        <Fragment slot="head">
          <h2 class="card__title">{feature.heading}</h2>
          <p>{feature.description}</p>
        </Fragment>
      </Template.Card>
      <Template.AlbumFrame album={albumData} />
    </section>
  </section>

  <script>
    import initGalleryFrame from '@Scripts/galleryViewer.js';
    import { runOnReady } from '@Scripts/utils/_runOnReady.js';
    runOnReady(initGalleryFrame);
  </script>
</Template.Base>
